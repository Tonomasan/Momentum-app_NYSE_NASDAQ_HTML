<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç±³å›½æ ªãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ æ¤œç´¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .slider-container {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ ç±³å›½æ ªãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ æ¤œç´¢</h1>
    
    <div class="slider-container">
        <label>1ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-1m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-1m-max" min="-50" max="100" step="1" value="30">
        <span id="range-1m">-10 ~ 30</span>
    </div>
    
    <div class="slider-container">
        <label>3ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-3m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-3m-max" min="-50" max="100" step="1" value="30">
        <span id="range-3m">-10 ~ 30</span>
    </div>
    
    <div class="slider-container">
        <label>6ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-6m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-6m-max" min="-50" max="100" step="1" value="30">
        <span id="range-6m">-10 ~ 30</span>
    </div>
    
    <button id="download-btn">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
    
    <!-- <table>
        <thead>
            <tr>
                <th>Ticker</th>
                <th>1ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
                <th>3ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
                <th>6ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
            </tr>
        </thead>
        <tbody id="stock-table-body"></tbody>
    </table> -->

    <style>
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .popup {
            background: white;
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }
        .popup-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
    <div>â€»è¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãã®éŠ˜æŸ„ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§é–‹ãã¾ã™ã€‚</div>
    <table>
        <thead>
            <tr>
                <th>Ticker</th>
                <th>1ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
                <th>3ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
                <th>6ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ </th>
            </tr>
        </thead>
        <tbody id="stock-table-body"></tbody>
    </table>
    <div id="popup-chart" class="overlay">
        <div class="popup-bg" onclick="closePopup()"></div>
        <div class="popup">
            <h2 id="chart_symbol">SYMBOL</h2>
            <a class="close" href="javascript:void(0);" onclick="closePopup()">&times;</a>
            <div id="chart"></div>
        </div>
    </div>
    <div class="slider-container">
        <label>1ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-1m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-1m-max" min="-50" max="100" step="1" value="30">
        <span id="range-1m">-10 ~ 30</span>
    </div>
    <div class="slider-container">
        <label>3ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-3m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-3m-max" min="-50" max="100" step="1" value="30">
        <span id="range-3m">-10 ~ 30</span>
    </div>
    <div class="slider-container">
        <label>6ãƒ¶æœˆãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ç¯„å›²: </label>
        <input type="range" id="slider-6m-min" min="-50" max="100" step="1" value="-10">
        <input type="range" id="slider-6m-max" min="-50" max="100" step="1" value="30">
        <span id="range-6m">-10 ~ 30</span>
    </div>
    <script src="https://unpkg.com/tabulator-tables@4.9.1/dist/js/tabulator.min.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <script>
        function openPopup(symbol) {
            document.getElementById("chart_symbol").innerText = symbol;
            document.getElementById("popup-chart").style.display = "flex";
            document.getElementById("chart").innerHTML = "";
            let tradingSymbol = symbol.includes(":") ? symbol : "NASDAQ:" + symbol;
            new TradingView.widget({
                "container_id": "chart",
                "width": "100%",
                "height": "400",
                "symbol": tradingSymbol,
                "interval": "D",
                "theme": "light",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "save_image": false
            });
        }
        function closePopup() {
            document.getElementById("popup-chart").style.display = "none";
        }
        async function loadStockData() {
            const response = await fetch("momentum_data_yf.csv");
            const text = await response.text();
            const rows = text.split("\n").slice(1);
            const stocks = rows.map(row => {
                const cols = row.split(",");
                return { ticker: cols[0], momentum1m: parseFloat(cols[1]), momentum3m: parseFloat(cols[2]), momentum6m: parseFloat(cols[3]) };
            });
            return stocks;
        }
        function updateTable(stocks) {
            const min1m = parseFloat(document.getElementById("slider-1m-min").value);
            const max1m = parseFloat(document.getElementById("slider-1m-max").value);
            const min3m = parseFloat(document.getElementById("slider-3m-min").value);
            const max3m = parseFloat(document.getElementById("slider-3m-max").value);
            const min6m = parseFloat(document.getElementById("slider-6m-min").value);
            const max6m = parseFloat(document.getElementById("slider-6m-max").value);
            const filteredStocks = stocks.filter(stock => 
                stock.momentum1m >= min1m && stock.momentum1m <= max1m &&
                stock.momentum3m >= min3m && stock.momentum3m <= max3m &&
                stock.momentum6m >= min6m && stock.momentum6m <= max6m
            );
            const tableBody = document.getElementById("stock-table-body");
            tableBody.innerHTML = "";
            filteredStocks.forEach(stock => {
                const row = document.createElement("tr");
                row.dataset.ticker = stock.ticker;
                row.innerHTML = `<td>${stock.ticker}</td><td>${stock.momentum1m}</td><td>${stock.momentum3m}</td><td>${stock.momentum6m}</td>`;
                tableBody.appendChild(row);
            });
        }
        document.addEventListener("DOMContentLoaded", async function() {
            const stocks = await loadStockData();
            updateTable(stocks);
            document.querySelectorAll("input[type=range]").forEach(slider => {
                slider.addEventListener("input", () => updateTable(stocks));
            });
        });
    </script>
    
    
</body>
</html>


